# Гостевая книга сайта

Создаёт посредника для фреймворка Laravel, для записи сведений о посетителях сайта.  
Сохраняются следующие данные:
- ip адрес;
- сведения о браузере;
- дата посещения;
- url;
- запрос.

Данные хранятся в текстовом файле (.txt).  
Поддерживает команды для контроля размера файла, и отсылки освобождаемых данных на адрес электронной почты.  
Поддерживаются локализации en, ru.  

## Требования
- PHP 8.1 или выше  
- Laravel 8.0  или выше
- Composer

## Установка
Добавьте в файл composer.json  

    "require": {
        "mldanshin/package-guestbook": "^1.0"
    }

    "repositories": [
        {
            "type": "vcs",
            "url": "https://github.com/mldanshin/package-guestbook"
        }
    ]

Выполните

    composer update

## Использование
### Шаг 1 **Требуется!**
Опубликуйте конфигурационный файл

    php artisan vendor:publish

где из списка выберите Provider: Danshin\Guestbook\Providers\PackegeServiceProvider. После чего в папке конфиг появится файл danshin-guestbook, где  

- limit_guest - максимальное количество данных для хранения (за одну единицу данных принимаются данные об одном госте), остальные при запуске команды (смотри ниже) будут удалены;
- mail.subject - тема письма;
- *mail.replay_to.address - адрес электронной почты, куда будут направляться письма, поле обязательно для заполнения!*

Кроме этого у Вас должны быть заполнены поля отправителя электронных писем в файле .env:
- MAIL_MAILER=
- MAIL_HOST=
- MAIL_PORT=
- MAIL_USERNAME=
- MAIL_PASSWORD=
- MAIL_FROM_ADDRESS=
- MAIL_FROM_NAME=

### Шаг 2 **Требуется!**
Добавьте в классе App\Http\Kernel Вашего приложения в массив $middleware строку

    \Danshin\Guestbook\Http\Middleware\CreatingGuest::class

### Доступны консольные команды:

    php artisan guestbook:cut

Удаляет данные сверх установленного в конфигурационном файле (danshin-guestbook.limit_guest) лимита. Сведения об удалённых записях отсылаются на установленную в конфигурационном файле почту (danshin-guestbook.mail.replay_to.address), если значение отсутствует, сведения не отправляются. Добавьте команду в планировщик  для автоматизации контроля за наполнением файла.

    php artisan guestbook:clear

Полностью очищает файл гостевой книги.

## Лицензия

Программное обеспечение с открытым исходным кодом, лицензированное в соответствии с [MIT license](https://opensource.org/licenses/MIT).